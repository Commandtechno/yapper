datasource db {
    // Change provider to whichever provide you're using.
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

enum CommandType {
    TEXT_COMMAND
    APPLICATION_COMMAND
}

enum InfrastructureUsed {
    SERVERLESS
    ENDPOINT
}

enum PurchaseType {
    ONCE
    RECURRING
}

model Cooldown {
    userId      String
    commandName String

    expiresAt DateTime

    commandType CommandType

    @@id([commandName, commandType, userId])
    @@map("command_cooldowns")
}

model UserLanguage {
    userId     String @id
    languageId String

    @@map("user_languages")
}

model Transcription {
    initialMessageId  String  @id
    responseMessageId String
    threadId          String?

    @@map("transcriptions")
}

model AutoTranscriptVoiceMessages {
    guildId String @id

    @@map("auto_transcript_voice_messages")
}

model Job {
    id                 String             @id
    attachmentUrl      String
    initialMessageId   String
    responseMessageId  String
    guildId            String
    infrastructureUsed InfrastructureUsed
    channelId          String
    interactionId      String?
    interactionToken   String?

    @@map("jobs")
}

model PremiumGuild {
    guildId     String      @id
    purchaserId String
    purchaser   PremiumUser @relation(fields: [purchaserId], references: [userId])

    @@map("premium_guilds")
}

model PremiumUser {
    userId         String             @id
    maxGuilds      Int
    premiumGuilds  PremiumGuild[]
    expiresAt      DateTime?
    purchase       PremiumPurchase[]

    @@map("premium_users")
}

model PremiumPurchase {
    purchaseId    String @id
    priceId       String
    userId        String @unique

    product       PremiumProduct @relation(fields: [priceId], references: [id])
    user          PremiumUser    @relation(fields: [userId], references: [userId])
}

model PremiumProduct {
    id        String @id
    maxGuilds Int
    price     BigInt?
    type      PurchaseType
    purchases PremiumPurchase[]

    @@map("premium_products")
}

model IgnoredUser {
    userId String @id

    @@map("ignored_users")
}
